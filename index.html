<!doctype html>
<html lang="he" data-baseline="stable-2025-10-01__rails-460px__galC-6-only">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>גרדניסיטי — ירוק אזרחי</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet" />

<style>
/* ==========================================================
   LIEBLING PRO — FONT FAMILY
   ========================================================== */
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProThin.woff2") format("woff2"), url("assets/fonts/LieblingProThin.woff") format("woff"); font-weight: 100; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProLight.woff2") format("woff2"), url("assets/fonts/LieblingProLight.woff") format("woff"); font-weight: 300; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProRegular.woff2") format("woff2"), url("assets/fonts/LieblingProRegular.woff") format("woff"); font-weight: 400; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProMedium.woff2") format("woff2"), url("assets/fonts/LieblingProMedium.woff") format("woff"); font-weight: 500; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProBold.woff2") format("woff2"), url("assets/fonts/LieblingProBold.woff") format("woff"); font-weight: 700; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProExtraBold.woff2") format("woff2"), url("assets/fonts/LieblingProExtraBold.woff") format("woff"); font-weight: 800; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProBlack.woff2") format("woff2"), url("assets/fonts/LieblingProBlack.woff") format("woff"); font-weight: 900; font-style: normal; font-display: swap; }

* { font-family: "Liebling Pro", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif !important; }
.s1-text p, .s2-text p, .sGeddes-text p, .s4-text p, .s5-text p, .s9-text p, .s11-text p, .s13-text p, .s14-text p { font-weight: 300 !important; }
.sRail-left p, .sRail-right p, .sRail-text p { font-weight: 300 !important; line-height: 1.35 !important; }

/* ===== Base (General) & VARIABLES ===== */
html, body {
    margin: 0; padding: 0; height: 100%;
    background: #f8fbf2; 
    color: #fff;
    /* Base is LTR for Mapbox/Browser compatibility, text blocks are locally RTL */
    direction: ltr; 
}

:root{
    /* HERO */ --shift:0px; --titleOpacity:0; --linksOpacity:0; --heroAlpha:1; --heroBlur:0;
    /* S1 */ --s1:0; --s1Overlay:0; --s1Y:0px; --s1ImgOpacity:0;
    /* S2 */ --s2:0; --s2Overlay:0; --s2Y:0px; --s2ImgOpacity:0;
    /* gallery-A-Left */ --galA:0; --galAImg0Opacity:0; --galAImg1Opacity:0; --galAImg2Opacity:0; --galAImg3Opacity:0; --galAReady:0;
    /* NEW: GEDDES PLAN (Like S2) */ --sGeddes:0; --sGeddesOverlay:0; --sGeddesY:0px; --sGeddesImgOpacity:0;
    /* S3 (full bleed) */ --s3:0; --s3ImgOpacity:0; --s3Scale:1;
    /* S4 */ --s4:0; --s4Overlay:0; --s4Y:0px; --s4ImgOpacity:0;
    /* NEW MAP SECTION */ --sMapA:0; --sMapAImgOpacity:0; 
    /* S5 */ --s5:0; --s5Overlay:0; --s5Y:0px; --s5ImgOpacity:0;
    /* gallery-B-Center */ --galB:0; --galBImg0Opacity:0; --galBImg1Opacity:0; --galBImg2Opacity:0; --galBImg3Opacity:0; --galBImg4Opacity:0; --galBReady:0;
    /* S8 (full bleed) */ --s8:0; --s8ImgOpacity:0; --s8Scale:1; --s8Ready:0;
    /* S9 */ --s9:0; --s9Overlay:0; --s9Y:0px; --s9ImgOpacity:0;
    /* gallery-C-Right (media left, no text) */ --galC:0; --galCImg0Opacity:0; --galCImg1Opacity:0; --galCImg2Opacity:0; --galCImg3Opacity:0; --galCImg4Opacity:0; --galCImg5Opacity:0; --galCReady:0;
    /* S11 (left text / right image) */ --s11:0; --s11Overlay:0; --s11Y:0px; --s11ImgOpacity:0;
    /* S12 (full bleed) */ --s12:0; --s12ImgOpacity:0; --s12Scale:1; --s12Ready:0;
    /* S13 (like S1) */ --s13:0; --s13Overlay:0; --s13Y:0px; --s13ImgOpacity:0;
    /* S14 (like S2) */ --s14:0; --s14Overlay:0; --s14Y:0px; --s14ImgOpacity:0;
    /* S15 (full bleed + centered overlay) */ --s15:0; --s15Overlay:0; --s15Y:0px; --s15ImgOpacity:0; --s15Scale:1; --s15Ready:0;
}

/* ===== HERO (RTL Structure) ===== */
.hero-fixed{ position:fixed; inset:0; z-index:3; opacity:var(--heroAlpha); filter:blur(calc(var(--heroBlur)*10px)); pointer-events:auto; will-change:opacity,filter; }
.hero-fixed[data-faded="true"] { pointer-events: none !important; }
.hero-bg{ position:absolute; inset:0; background:url("assets/hero1cg.jpg") center/cover no-repeat; opacity:0; animation:heroIn 900ms ease-out forwards; pointer-events:none; }
@keyframes heroIn{ from{opacity:0} to{opacity:1} }
.hero-media{ right:96px; left:82px; position:absolute; top:96px; bottom:96px; display:flex; align-items:flex-end; justify-content:flex-start; overflow:hidden; }
.col{ position:relative; max-width:700px; transform:translateY(var(--shift)); will-change:transform; }
.hero-title{ margin:0 0 24px 0; font-weight:400; font-size:100px; line-height:100px; opacity:var(--titleOpacity); }
.hero-title .line{ display:block; }
.hero-links{ display:flex; flex-direction:column; gap:10px; font-size:24px; line-height:30px; opacity:var(--linksOpacity); }
.hero-links a{ color:#fff; text-decoration:none; transition:color .2s ease; }
.hero-links a:hover,.hero-links a:focus-visible{ color:#00A86B; }
.driver{ height:200vh; }

/* ===== PINNED FRAMES (RTL Positioning) ===== */
figure.frame { margin: 0; }
.frame { position: fixed; z-index: 1; pointer-events: none; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.frame img { width: 100%; height: 100%; object-fit: contain; display: block; }
/* S1 image LEFT (text right) */
.s1-frame { top: 96px; bottom: 96px; right: calc(96px + 460px + 96px); left: 82px; opacity: var(--s1ImgOpacity); }
/* S2 image RIGHT (text left) */
.s2-frame{ top:96px; bottom:96px; right: 96px; left: calc(82px + 96px + 460px); opacity: var(--s2ImgOpacity); }
/* gallery-A-Left (media LEFT, like S1) */
.galA-left-frame{ top:96px; bottom:96px; right: calc(96px + 460px + 96px); left: 82px; display:block; }
.galA-left-frame img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; object-position:center; will-change:opacity; }
#galA-img0{ opacity: var(--galAImg0Opacity); }
#galA-img1{ opacity: var(--galAImg1Opacity); }
#galA-img2{ opacity: var(--galAImg2Opacity); }
#galA-img3{ opacity: var(--galAImg3Opacity); }
/* NEW: GEDDES PLAN FRAME (Image Right, like S2) */
.sGeddes-frame { top: 96px; bottom: 96px; right: 96px; left: calc(82px + 96px + 460px); opacity: var(--sGeddesImgOpacity); }
/* S3 full-bleed */
.s3-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s3ImgOpacity); }
.frame.s3-frame>img{ width:100%; height:100%; object-fit:cover !important; object-position:center; transform: scale(var(--s3Scale)); transform-origin: center center; will-change: transform; }
/* S4 image LEFT (like S1) */
.s4-frame{ top:96px; bottom:96px; right: calc(96px + 460px + 96px); left: 82px; opacity: var(--s4ImgOpacity); }
/* ================= MapA CSS ======================*/
.sMapA-frame { top: 0; right: 0; bottom: 0; left: 0; opacity: var(--sMapAImgOpacity); z-index: 4; position: fixed !important; width: 100% !important; height: 100% !important; inset: 0 !important; }
#mapA-container { width: 100% !important; height: 100% !important; position: relative; pointer-events: none; }
.sMapA-frame.active #mapA-container { pointer-events: auto; z-index: 10 !important; }
/* Exit button position (RTL: top-right) */
#exit-map-button {
    position: absolute; top: 20px; right: 20px; left: auto; z-index: 100;
    background-color: #00A86B; color: white; border: none; border-radius: 4px; padding: 10px 15px;
    font-size: 16px; font-weight: 600; line-height: 1; text-transform: none; cursor: pointer;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); transition: background-color 0.2s ease, opacity 0.3s ease;
    opacity: 0; pointer-events: none;
}
#exit-map-button:hover { background-color: #007A50; }
.sMapA-frame.active #exit-map-button { opacity: 1; pointer-events: auto; }
/* ====================================================== */
/* S5 image RIGHT (like S2) */
.s5-frame{ top:96px; bottom:96px; right: 96px; left: calc(82px + 96px + 460px); opacity: var(--s5ImgOpacity); }
/* gallery-B-Center */
.galB-center-frame{ top:96px; bottom:96px; right:96px; left:82px; display:block; }
.galB-center-frame img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; object-position:center; will-change:opacity; }
#galB-img0{ opacity: var(--galBImg0Opacity); }
#galB-img1{ opacity: var(--galBImg1Opacity); }
#galB-img2{ opacity: var(--galBImg2Opacity); }
#galB-img3{ opacity: var(--galBImg3Opacity); }
#galB-img4{ opacity: var(--galBImg4Opacity); }
/* S8 full-bleed */
.s8-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s8ImgOpacity); }
.frame.s8-frame>img{ width:100%; height:100%; object-fit:cover !important; object-position:center; transform: scale(var(--s8Scale)); transform-origin: center center; will-change: transform; }
/* S9 image LEFT (like S1) */
.s9-frame{ top:96px; bottom:96px; right: calc(96px + 460px + 96px); left: 82px; opacity: var(--s9ImgOpacity); }
/* gallery-C-Left (media on RIGHT, like S2) */
.galC-left-frame{ top:96px; bottom:96px; right: 96px; left: calc(82px + 96px + 460px); display:block; }
.galC-left-frame img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; object-position:center; will-change:opacity; }
#galC-img0{ opacity: var(--galCImg0Opacity); }
#galC-img1{ opacity: var(--galCImg1Opacity); }
#galC-img2{ opacity: var(--galCImg2Opacity); }
#galC-img3{ opacity: var(--galCImg3Opacity); }
#galC-img4{ opacity: var(--galCImg4Opacity); }
#galC-img5{ opacity: var(--galCImg5Opacity); }
/* S11 image LEFT (like S1) */
.s11-frame{ top:96px; bottom:96px; right: calc(96px + 460px + 96px); left: 82px; opacity: var(--s11ImgOpacity); }
/* S12 full-bleed */
.s12-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s12ImgOpacity); }
.frame.s12-frame>img{ width:100%; height:100%; object-fit:cover !important; object-position:center; transform: scale(var(--s12Scale)); transform-origin: center center; will-change: transform; }
/* S13 image LEFT (like S1) */
.s13-frame{ top:96px; bottom:96px; right: calc(96px + 460px + 96px); left: 82px; opacity: var(--s13ImgOpacity); }
/* S14 image RIGHT (like S2) */
.s14-frame{ top:96px; bottom:96px; right: 96px; left: calc(82px + 96px + 460px); opacity: var(--s14ImgOpacity); }
/* S15 full-bleed */
.s15-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s15ImgOpacity); }
.frame.s15-frame>img{ width:100%; height:100%; object-fit:cover !important; object-position:center; transform: scale(var(--s15Scale)); transform-origin: center center; will-change: transform; }

/* ===== SECTION DRIVERS ===== */
.s1-wrap, .s2-wrap, .galA-left-wrap, .sGeddes-wrap, .s3-wrap, .s4-wrap, .s5-wrap, .sMapA-wrap, .galB-center-wrap, .s8-wrap, .s9-wrap, .galC-left-wrap, .s11-wrap, .s12-wrap, .s13-wrap, .s14-wrap, .s15-wrap{ position:relative; height:280vh; background:#f8fbf2; }

/* ===== TEXT OVERLAYS (RTL Positioning) ===== */
.s1-overlay, .s2-overlay, .sGeddes-overlay, .s4-overlay, .s5-overlay, .s9-overlay, .s11-overlay, .s13-overlay, .s14-overlay, .s15-overlay{ position:fixed; inset:0; z-index:2; pointer-events:none; }
.s1-overlay{ opacity:var(--s1Overlay); } .s2-overlay{ opacity:var(--s2Overlay); } .sGeddes-overlay{ opacity:var(--sGeddesOverlay); } .s4-overlay{ opacity:var(--s4Overlay); } .s5-overlay{ opacity:var(--s5Overlay); } .s9-overlay{ opacity:var(--s9Overlay); } .s11-overlay{ opacity:var(--s11Overlay); } .s13-overlay{ opacity:var(--s13Overlay); } .s14-overlay{ opacity:var(--s14Overlay); } .s15-overlay{ opacity:var(--s15Overlay); }
/* RIGHT rails (text right) */
.s1-rail, .s4-rail, .s9-rail, .s11-rail, .s13-rail{ position:absolute; top:0; bottom:0; right:96px; width:460px; overflow:hidden; }
/* LEFT rails (text left) */
.s2-rail, .sGeddes-rail, .s5-rail, .s14-rail{ position:absolute; top:0; bottom:0; left:96px; width:460px; overflow:hidden; }

.s1-text{ transform:translateY(var(--s1Y)); color:#111; text-align:right; } 
.s2-text{ transform:translateY(var(--s2Y)); color:#111; text-align:left; } 
.sGeddes-text{ transform:translateY(var(--sGeddesY)); color:#111; text-align:left; } 
.s4-text{ transform:translateY(var(--s4Y)); color:#111; text-align:right; } 
.s5-text{ transform:translateY(var(--s5Y)); color:#111; text-align:left; } 
.s9-text{ transform:translateY(var(--s9Y)); color:#111; text-align:right; } 
.s11-text{ transform:translateY(var(--s11Y)); color:#111; text-align:right; } 
.s13-text{ transform:translateY(var(--s13Y)); color:#111; text-align:right; } 
.s14-text{ transform:translateY(var(--s14Y)); color:#111; text-align:left; } 

/* ===== S15: CENTER COLUMN OVERLAY (RTL Positioning) ===== */
.s15-rail{ right:50%; transform:translateX(50%); position:absolute; top:0; bottom:0; width:700px; max-width:calc(100vw - 96px - 82px); overflow:hidden; }
.s15-text{ transform:translateY(var(--s15Y)); color:#fff; text-align:center; }
.s1-text p, .s2-text p, .sGeddes-text p, .s4-text p, .s5-text p, .s9-text p, .s11-text p, .s13-text p, .s14-text p, .s15-text p{ margin:0 0 14px 0; font-size:20px; line-height:28px; }
.after{ min-height:120vh; }

/* ===== MOBILE & TABLET STYLES (RTL-adjusted centering) ===== */
@media (max-width:600px){
    /* ... Mobile CSS for brevity ... */
    .s1-text, .s2-text, .sGeddes-text, .s4-text, .s5-text, .s9-text, .s11-text, .s13-text, .s14-text, .s15-text { text-align: right; }
    .s15-text { right: 50% !important; transform: translateX(50%) !important; left: auto !important; }
}
@media (min-width:601px) and (max-width:1023px) {
    /* ... Tablet CSS for brevity ... */
    .s1-text, .s2-text, .sGeddes-text, .s4-text, .s5-text, .s9-text, .s11-text, .s13-text, .s14-text, .s15-text { text-align: right !important; }
    .s15-text { right: 50% !important; transform: translateX(50%) !important; left: auto !important; }
}
</style>
</head>
<body>

<div class="hero-fixed" id="hero" dir="rtl" data-faded="false">
<div class="hero-bg" aria-hidden="true"></div>
<div class="hero-media" id="hero-media">
<div class="col" id="hero-col">
<h1 class="hero-title" id="hero-title">
<span class="line">גרדניסיטי</span>
<span class="line"><bdo dir="rtl">ירוק אזרחי</bdo></span>
</h1>
<nav class="hero-links" id="hero-links" aria-label="Primary">
<a href="#sGeddes-wrap"><bdo dir="rtl">מה ראה גדס?</bdo></a>
<a href="#s3-wrap"><bdo dir="rtl">צמיחה</bdo></a>
<a href="#s8-wrap"><bdo dir="rtl">ירוק אזרחי</bdo></a>
<a href="#s12-wrap"><bdo dir="rtl">עלי SDGs</bdo></a>
<a href="https://www.megama.net"><bdo dir="rtl">עב / <bdo dir="ltr">&#x200E;EN</bdo></bdo></a>
</nav>
</div>
</div>
</div>

<figure class="frame s1-frame" aria-hidden="true"><img id="s1-img" src="assets/section1.jpg" alt=""></figure>
<figure class="frame s2-frame" aria-hidden="true"><img id="s2-img" src="assets/section2.jpg" alt=""></figure>
<figure class="frame galA-left-frame" aria-hidden="true">
    <img id="galA-img0" src="assets/gallery-A.jpg" alt=""><img id="galA-img1" src="assets/gallery-A1.jpg" alt="">
    <img id="galA-img2" src="assets/gallery-A2.jpg" alt=""><img id="galA-img3" src="assets/gallery-A3.jpg" alt="">
</figure>
<figure class="frame sGeddes-frame" aria-hidden="true"><img id="sGeddes-img" src="assets/geddesplan.jpg" alt=""></figure>
<figure class="frame s3-frame" aria-hidden="true"><img id="s3-img" src="assets/section3.jpg" alt=""></figure>
<figure class="frame s4-frame" aria-hidden="true"><img id="s4-img" src="assets/section4.jpg" alt=""></figure>
<figure class="frame sMapA-frame" aria-hidden="true" id="mapSection">
    <div id="mapA-container"></div>
    <button id="exit-map-button" dir="rtl"><bdo dir="rtl">יציאה מהמפה ↓</bdo></button>
</figure>
<figure class="frame s5-frame" aria-hidden="true"><img id="s5-img" src="assets/section5.jpg" alt=""></figure>
<figure class="frame galB-center-frame" aria-hidden="true">
    <img id="galB-img0" src="assets/gallery-B.jpg" alt=""><img id="galB-img1" src="assets/gallery-B1.jpg" alt="">
    <img id="galB-img2" src="assets/gallery-B2.jpg" alt=""><img id="galB-img3" src="assets/gallery-B3.jpg" alt="">
    <img id="galB-img4" src="assets/gallery-B4.jpg" alt="">
</figure>
<figure class="frame s8-frame" aria-hidden="true"><img id="s8-img" src="assets/section8.jpg" alt=""></figure>
<figure class="frame s9-frame" aria-hidden="true"><img id="s9-img" src="assets/section9.jpg" alt=""></figure>
<figure class="frame galC-left-frame" aria-hidden="true">
    <img id="galC-img0" src="assets/gallery-C.jpg" alt=""><img id="galC-img1" src="assets/gallery-C1.jpg" alt="">
    <img id="galC-img2" src="assets/gallery-C2.jpg" alt=""><img id="galC-img3" src="assets/gallery-C3.jpg" alt="">
    <img id="galC-img4" src="assets/gallery-C4.jpg" alt=""><img id="galC-img5" src="assets/gallery-C5.jpg" alt="">
</figure>
<figure class="frame s11-frame" aria-hidden="true"><img id="s11-img" src="assets/section11.jpg" alt=""></figure>
<figure class="frame s12-frame" aria-hidden="true"><img id="s12-img" src="assets/section12.jpg" alt=""></figure>
<figure class="frame s13-frame" aria-hidden="true"><img id="s13-img" src="assets/section13.jpg" alt=""></figure>
<figure class="frame s14-frame" aria-hidden="true"><img id="s14-img" src="assets/section14.jpg" alt=""></figure>
<figure class="frame s15-frame" aria-hidden="true"><img id="s15-img" src="assets/section15.jpg" alt=""></figure>

<section class="driver" id="driver"></section>
<section class="s1-wrap" id="s1-wrap"></section>
<div class="s1-overlay" dir="rtl">
    <div class="s1-rail"><div class="s1-text" id="s1-text">
        <p><strong>כותרת חלק ראשון.</strong> הטקסט במסילה הימנית זורם...</p><p>הטקסט ממלא את הפס הרחב על ידי גלילת חלון התצוגה...</p><p>בצד שמאל התמונה מקובעת, עוברת בינתיים שינוי מבוקר ושקוף.</p><p>כאשר הטקסט מסיים להיגלל, אנו עוברים לקטע הבא.</p><p>זהו טקסט ארוך להדגמת גלילה: לורם איפסום דולור סיט אמט, קונסקטטור אדיפיסינג אלית. אליקום ואריוס, מטוס נק טינצידונט טינצידונט, נונק אראט טינצידונט סאפיאן, ול לאורט לקוס ניסי אגט ג'וסטו. נולאם אוט פלסראט אודיו.</p><p>נולא ויטא ארוס נק מי רוטרום אליפנד אט נק דואי. דואיס אולטריסס קונסקוואט לובורטיס.</p><p>פוסצ'ה אה אליקום לורם, אק לקיניה אסט. פראסנט רוטרום אודיו אגט טלוס מאטיס, אט מאלסואדה לורם דאפבוס. פללנטסקה אקומסאן דואי אה לקטוס פורטיטור וסטיבולום. נאם וננאטיס אורנה אליט, אט קונדימנטום ארוס אלמנטום אינטרדום. פרוין סד סמפר נולא. מאוריס פלסראט נון דואי אט פרטיום. אוט אליקום טלוס איפסום, נון פורטא אקס קונגוא אה. וסטיבולום מולסטי אגסטאס טלוס, ויטא טינצידונט ניבה מוליס נק. פוסצ'ה קויס מאגנה אליט. אנאן מי טלוס, פרמנטום או פהארטרא איד, פרמנטום נון טורפיס.</p>
    </div></div>
</div>

<section class="s2-wrap" id="s2-wrap"></section>
<div class="s2-overlay" dir="rtl">
    <div class="s2-rail"><div class="s2-text" id="s2-text">
        <p><strong>כותרת חלק שני.</strong> הקטע השני הופך את התמונה והטקסט...</p><p>המסילה הופכת לצד שמאל (שוליים שמאליים), כשהתמונה משתלבת בימין.</p><p>זה שומר על דפוס ויזואלי ברור, לסירוגין מצד לצד.</p><p>וממשיך לשמור על קצב קבוע.</p><p>זהו טקסט ארוך להדגמת גלילה: לורם איפסום דולור סיט אמט, קונסקטטור אדיפיסינג אלית. אליקום ואריוס, מטוס נק טינצידונט טינצידונט, נונק אראט טינצידונט סאפיאן, ול לאורט לקוס ניסי אגט ג'וסטו. נולאם אוט פלסראט אודיו.</p><p>נולא ויטא ארוס נק מי רוטרום אליפנד אט נק דואי. דואיס אולטריסס קונסקוואט לובורטיס.</p><p>פוסצ'ה אה אליקום לורם, אק לקיניה אסט. פראסנט רוטרום אודיו אגט טלוס מאטיס, אט מאלסואדה לורם דאפבוס. פללנטסקה אקומסאן דואי אה לקטוס פורטיטור וסטיבולום. נאם וננאטיס אורנה אליט, אט קונדימנטום ארוס אלמנטום אינטרדום. פרוין סד סמפר נולא. מאוריס פלסראט נון דואי אט פרטיום. אוט אליקום טלוס איפסום, נון פורטא אקס קונגוא אה. וסטיבולום מולסטי אגסטאס טלוס, ויטא טינצידונט ניבה מוליס נק. פוסצ'ה קויס מאגנה אליט. אנאן מי טלוס, פרמנטום או פהארטרא איד, פרמנטום נון טורפיס.</p>
    </div></div>
</div>

<section class="galA-left-wrap" id="galA-wrap"></section>

<section class="sGeddes-wrap" id="sGeddes-wrap"></section>
<div class="sGeddes-overlay" dir="rtl">
    <div class="sGeddes-rail"><div class="sGeddes-text" id="sGeddes-text">
        <p><strong>תוכנית גדס</strong></p><p>תוכן הטקסט שלך לתוכנית גדס נמצא כאן. הוא ממוקם במסילה השמאלית (text left/image right) בדיוק כמו קטע 2.</p><p>יש להבטיח כי יש מספיק טקסט כדי ליצור גלילה חלקה באזור זה.</p>
    </div></div>
</div>

<section class="s3-wrap" id="s3-wrap"></section>

<section class="s4-wrap" id="s4-wrap"></section>
<div class="s4-overlay" dir="rtl">
    <div class="s4-rail"><div class="s4-text" id="s4-text">
        <p><strong>חלק רביעי</strong> חוזר למסגרת הצפופה...</p><p>הנרטיב של המסילה הימנית זורם...</p><p>התמונה האופקית יושבת יציבה משמאל...</p><p>השוליים והקצב תואמים לחלק הראשון...</p><p>ומחזור הנופים נמשך.</p>
    </div></div>
</div>

<section class="sMapA-wrap" id="sMapA-wrap"></section>

<section class="s5-wrap" id="s5-wrap"></section>
<div class="s5-overlay" dir="rtl">
    <div class="s5-rail"><div class="s5-text" id="s5-text">
        <p><strong>חלק חמישי</strong> מחליף שוב את המסילה...</p><p>כעת הנרטיב מחבק את השוליים השמאליים...</p><p>בעוד התמונה מחזיקה את שדה הראייה הימני...</p><p>וממסגר את הפנייה הבאה בסיפור...</p><p>באותו קצב ומקצב.</p>
    </div></div>
</div>

<section class="galB-center-wrap" id="galB-wrap"></section>

<section class="s8-wrap" id="s8-wrap"></section>

<section class="s9-wrap" id="s9-wrap"></section>
<div class="s9-overlay" dir="rtl">
    <div class="s9-rail"><div class="s9-text" id="s9-text">
        <p><strong>חלק תשיעי</strong> מחזיר אותנו למסגרת הצפופה...</p><p>המסילה הימנית נושאת את הנרטיב קדימה...</p><p>משמאל, התמונה מייצבת את הסצנה...</p><p>השוליים, הקצב והפעימות משקפים את חלק אחד...</p><p>כך שהסיפור נושם בקצב מוכר.</p>
    </div></div>
</div>

<section class="galC-left-wrap" id="galC-wrap"></section>

<section class="s11-wrap" id="s11-wrap"></section>
<div class="s11-overlay" dir="rtl">
    <div class="s11-rail"><div class="s11-text" id="s11-text">
        <p><strong>חלק אחד עשר</strong> ממשיך את החוט...</p><p>חוזר למסילה הימנית; התמונה מעגנת את השמאל...</p><p>השוליים והקצב ללא שינוי...</p><p>קרוספיידים סטנדרטיים שומרים על הקצב...</p><p>כשהסיפור מתיישב במיקוד.</p>
    </div></div>
</div>

<section class="s12-wrap" id="s12-wrap"></section>

<section class="s13-wrap" id="s13-wrap"></section>
<div class="s13-overlay" dir="rtl">
    <div class="s13-rail"><div class="s13-text" id="s13-text">
        <p><strong>חלק שלוש עשרה</strong> חוזר למסגרת הצפופה...</p><p>הנרטיב של המסילה הימנית מושך אותנו קדימה...</p><p>התמונה השמאלית מייצבת את הסצנה...</p><p>השוליים והקצב מהדהדים את חלק אחד...</p><p>נושם בקצב המוכר.</p>
    </div></div>
</div>

<section class="s14-wrap" id="s14-wrap"></section>
<div class="s14-overlay" dir="rtl">
    <div class="s14-rail"><div class="s14-text" id="s14-text">
        <p><strong>חלק ארבעה עשר</strong> הופך את המסילה...</p><p>טקסט לשמאל, תמונה לימין...</p><p>הקצב והדהיות תואמים לחלק שני...</p><p>כשהנוף מתרחב ומתיישב...</p><p>אל הקצב הבא.</p>
    </div></div>
</div>

<section class="s15-wrap" id="s15-wrap"></section>
<div class="s15-overlay" dir="rtl">
    <div class="s15-rail"><div class="s15-text" id="s15-text">
        <p><strong>גרדניסיטי</strong> כתיבה, עיצוב, אוצרות:<br>מגמה / רבקה שטרנברג, קרן אבני</p><p><strong>קרדיטים לצילום:</strong><br>1 - המכון הלאומי למפות (מפ"י); 2-10, 15-25 - אוסף הצילומים של מטסון (ג. אריק ואדית), LOC; 11-14 - בוריס כרמי, הספרייה הלאומית; 26 - תומר אפלבאום</p><p>
        <a href="#sGeddes-wrap"><bdo dir="rtl">מה ראה גדס?</bdo></a><br>
        <a href="#s3-wrap"><bdo dir="rtl">צמיחה</bdo></a><br>
        <a href="#s8-wrap"><bdo dir="rtl">ירוק אזרחי</bdo></a><br>
        <a href="#s12-wrap"><bdo dir="rtl">עלי SDGs</bdo></a><br>
        <a href="https://www.megama.net" target="_blank"><bdo dir="rtl">עב / <bdo dir="ltr">&#x200E;EN</bdo></bdo></a>
        </p>
    </div></div>
</div>
<section class="after"></section>


<script>
(function(){
const root=document.documentElement;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const easeInOutCubic=t=>t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
const easePow=(t,p)=>Math.pow(t,p);

/* ---------- HERO ---------- */
const driver=document.getElementById('driver');
const heroFixed=document.getElementById('hero');
const heroMedia=document.getElementById('hero-media');
const heroCol=document.getElementById('hero-col');
const heroTitle=document.getElementById('hero-title');
const heroLinks=document.getElementById('hero-links');
let startShift=0,endShift=0;

function measureHero(){
const prev=heroCol.style.transform; heroCol.style.transform='translateY(0px)';
const lines=heroTitle.querySelectorAll('.line');
const third=lines[2]||lines[lines.length-1];
const thirdRect=third.getBoundingClientRect();
const lastLinkRect=(heroLinks.lastElementChild||heroLinks).getBoundingClientRect();
const mediaRect=heroMedia.getBoundingClientRect();
const mediaBaseline=mediaRect.bottom;
startShift=mediaBaseline-thirdRect.bottom;
endShift=mediaBaseline-lastLinkRect.bottom;
heroCol.style.transform=prev||'';
root.style.setProperty('--shift',startShift.toFixed(1)+'px');
}

function progressOf(el){
const r=el.getBoundingClientRect();
const vh=window.innerHeight||document.documentElement.clientHeight;
const total=r.height-vh;
if(total<=0) return 0;
return clamp(-r.top/total,0,1);
}

/* ---------- WRAPS & TEXT MEASUREMENT ---------- */
const s1Wrap=document.getElementById('s1-wrap');
const s2Wrap=document.getElementById('s2-wrap');
const galAWrap=document.getElementById('galA-wrap');
const sGeddesWrap=document.getElementById('sGeddes-wrap');
const s3Wrap=document.getElementById('s3-wrap');
const s4Wrap=document.getElementById('s4-wrap');
const sMapAWrap=document.getElementById('sMapA-wrap');
const s5Wrap=document.getElementById('s5-wrap');
const galBWrap=document.getElementById('galB-wrap');
const s8Wrap=document.getElementById('s8-wrap');
const s9Wrap=document.getElementById('s9-wrap');
const galCWrap=document.getElementById('galC-wrap');
const s11Wrap=document.getElementById('s11-wrap');
const s12Wrap=document.getElementById('s12-wrap');
const s13Wrap=document.getElementById('s13-wrap');
const s14Wrap=document.getElementById('s14-wrap');
const s15Wrap=document.getElementById('s15-wrap');

const s1Text=document.getElementById('s1-text');
const s2Text=document.getElementById('s2-text');
const sGeddesText=document.getElementById('sGeddes-text');
const s4Text=document.getElementById('s4-text');
const s5Text=document.getElementById('s5-text');
const s9Text=document.getElementById('s9-text');
const s11Text=document.getElementById('s11-text');
const s13Text=document.getElementById('s13-text');
const s14Text=document.getElementById('s14-text');
const s15Text=document.getElementById('s15-text');

let s1StartY=0, s1EndY=0;
let s2StartY=0, s2EndY=0;
let sGeddesStartY=0, sGeddesEndY=0;
let s4StartY=0, s4EndY=0;
let s5StartY=0, s5EndY=0;
let s9StartY=0, s9EndY=0;
let s11StartY=0, s11EndY=0;
let s13StartY=0, s13EndY=0;
let s14StartY=0, s14EndY=0;
let s15StartY=0, s15EndY=0;

function measureS1(){ const vh=window.innerHeight; const h=s1Text.scrollHeight; s1StartY=vh; s1EndY=-h; root.style.setProperty('--s1Y', s1StartY+'px'); }
function measureS2(){ const vh=window.innerHeight; const h=s2Text.scrollHeight; s2StartY=vh; s2EndY=-h; root.style.setProperty('--s2Y', s2StartY+'px'); }
function measureSGeddes(){ const vh=window.innerHeight; const h=sGeddesText.scrollHeight; sGeddesStartY=vh; sGeddesEndY=-h; root.style.setProperty('--sGeddesY', sGeddesStartY+'px'); }
function measureS4(){ const vh=window.innerHeight; const h=s4Text.scrollHeight; s4StartY=vh; s4EndY=-h; root.style.setProperty('--s4Y', s4StartY+'px'); }
function measureS5(){ const vh=window.innerHeight; const h=s5Text.scrollHeight; s5StartY=vh; s5EndY=-h; root.style.setProperty('--s5Y', s5StartY+'px'); }
function measureS9(){ const vh=window.innerHeight; const h=s9Text.scrollHeight; s9StartY=vh; s9EndY=-h; root.style.setProperty('--s9Y', s9StartY+'px'); }
function measureS11(){ const vh=window.innerHeight; const h=s11Text.scrollHeight; s11StartY=vh; s11EndY=-h; root.style.setProperty('--s11Y', s11StartY+'px'); }
function measureS13(){ const vh=window.innerHeight; const h=s13Text.scrollHeight; s13StartY=vh; s13EndY=-h; root.style.setProperty('--s13Y', s13StartY+'px'); }
function measureS14(){ const vh=window.innerHeight; const h=s14Text.scrollHeight; s14StartY=vh; s14EndY=-h; root.style.setProperty('--s14Y', s14StartY+'px'); }
function measureS15(){ const vh=window.innerHeight; const h=s15Text.scrollHeight; s15StartY=vh; s15EndY=-h; root.style.setProperty('--s15Y', s15StartY+'px'); }

/* --- Load gates (first images) --- */
const galAImg0 = document.getElementById('galA-img0');
function markGalAReady(){ root.style.setProperty('--galAReady','1'); }
if (galAImg0 && galAImg0.complete && galAImg0.naturalWidth > 0) markGalAReady();
else if (galAImg0) galAImg0.addEventListener('load', markGalAReady, { once:true });

const galBImg0 = document.getElementById('galB-img0');
function markGalBReady(){ root.style.setProperty('--galBReady','1'); }
if (galBImg0 && galBImg0.complete && galBImg0.naturalWidth > 0) markGalBReady();
else if (galBImg0) galBImg0.addEventListener('load', markGalBReady, { once:true });

const s8Img = document.getElementById('s8-img');
function markS8Ready(){ root.style.setProperty('--s8Ready','1'); }
if (s8Img && s8Img.complete && s8Img.naturalWidth > 0) markS8Ready();
else if (s8Img) s8Img.addEventListener('load', markS8Ready, { once:true });

const galCImg0 = document.getElementById('galC-img0');
function markGalCReady(){ root.style.setProperty('--galCReady','1'); }
if (galCImg0 && galCImg0.complete && galCImg0.naturalWidth > 0) markGalCReady();
else if (galCImg0) galCImg0.addEventListener('load', markGalCReady, { once:true });

const s12Img = document.getElementById('s12-img');
function markS12Ready(){ root.style.setProperty('--s12Ready','1'); }
if (s12Img && s12Img.complete && s12Img.naturalWidth > 0) markS12Ready();
else if (s12Img) s12Img.addEventListener('load', markS12Ready, { once:true });

const s15Img = document.getElementById('s15-img');
function markS15Ready(){ root.style.setProperty('--s15Ready','1'); }
if (s15Img && s15Img.complete && s15Img.naturalWidth > 0) markS15Ready();
else if (s15Img) s15Img.addEventListener('load', markS15Ready, { once:true });


function update(){
/* HERO choreography */
const p=progressOf(driver);
const pFade=easeInOutCubic(clamp(p/0.60,0,1));
root.style.setProperty('--titleOpacity',pFade.toFixed(3));
const pSlide=clamp((p-0.60)/0.40,0,1);
const shift=startShift+(endShift-startShift)*pSlide;
root.style.setProperty('--shift',shift.toFixed(1)+'px');
root.style.setProperty('--linksOpacity',pSlide.toFixed(3));
root.style.setProperty('--heroAlpha',(1-p).toFixed(3));
root.style.setProperty('--heroBlur',(p*0.8).toFixed(3));
heroFixed.setAttribute('data-faded', p > 0.999 ? 'true' : 'false');


/* Progress */
const s1=progressOf(s1Wrap);
const s2=progressOf(s2Wrap);
const galA=progressOf(galAWrap);
const sGeddes=progressOf(sGeddesWrap);
const s3=progressOf(s3Wrap);
const s4=progressOf(s4Wrap);
const sMapA=progressOf(sMapAWrap);
const s5=progressOf(s5Wrap);
const galB=progressOf(galBWrap);
const s8=progressOf(s8Wrap);
const s9=progressOf(s9Wrap);
const galC=progressOf(galCWrap);
const s11=progressOf(s11Wrap);
const s12=progressOf(s12Wrap);
const s13=progressOf(s13Wrap);
const s14=progressOf(s14Wrap);
const s15=progressOf(s15Wrap);

root.style.setProperty('--s1',s1.toFixed(3));
root.style.setProperty('--s2',s2.toFixed(3));
root.style.setProperty('--galA',galA.toFixed(3));
root.style.setProperty('--sGeddes',sGeddes.toFixed(3));
root.style.setProperty('--s3',s3.toFixed(3));
root.style.setProperty('--s4',s4.toFixed(3));
root.style.setProperty('--sMapA',sMapA.toFixed(3));
root.style.setProperty('--s5',s5.toFixed(3));
root.style.setProperty('--galB',galB.toFixed(3));
root.style.setProperty('--s8',s8.toFixed(3));
root.style.setProperty('--s9',s9.toFixed(3));
root.style.setProperty('--galC',galC.toFixed(3));
root.style.setProperty('--s11',s11.toFixed(3));
root.style.setProperty('--s12',s12.toFixed(3));
root.style.setProperty('--s13',s13.toFixed(3));
root.style.setProperty('--s14',s14.toFixed(3));
root.style.setProperty('--s15',s15.toFixed(3));

/* Overlays */
root.style.setProperty('--s1Overlay',(s1>0 && s1<1)?1:0);
root.style.setProperty('--s2Overlay',(s2>0 && s2<1)?1:0);
root.style.setProperty('--sGeddesOverlay',(sGeddes>0 && sGeddes<1)?1:0);
root.style.setProperty('--s4Overlay',(s4>0 && s4<1)?1:0);
root.style.setProperty('--s5Overlay',(s5>0 && s5<1)?1:0);
root.style.setProperty('--s9Overlay',(s9>0 && s9<1)?1:0);
root.style.setProperty('--s11Overlay',(s11>0 && s11<1)?1:0);
root.style.setProperty('--s13Overlay',(s13>0 && s13<1)?1:0);
root.style.setProperty('--s14Overlay',(s14>0 && s14<1)?1:0);
root.style.setProperty('--s15Overlay',(s15>0 && s15<1)?1:0);

/* Text sweeps (consistent curves) */
const E=0.8;
const s1Raw=clamp((s1-0.75)/0.25,0,1); root.style.setProperty('--s1Y', (s1StartY +(s1EndY -s1StartY )*easePow(s1Raw,E))+'px');
const s2Raw=clamp((s2-0.25)/0.75,0,1); root.style.setProperty('--s2Y', (s2StartY +(s2EndY -s2StartY )*easePow(s2Raw,E))+'px');
const sGeddesRaw=clamp((sGeddes-0.25)/0.75,0,1); root.style.setProperty('--sGeddesY', (sGeddesStartY +(sGeddesEndY -sGeddesStartY )*easePow(sGeddesRaw,E))+'px');
const s4Raw=clamp((s4-0.75)/0.25,0,1); root.style.setProperty('--s4Y', (s4StartY +(s4EndY -s4StartY )*easePow(s4Raw,E))+'px');
const s5Raw=clamp((s5-0.25)/0.75,0,1); root.style.setProperty('--s5Y', (s5StartY +(s5EndY -s5StartY )*easePow(s5Raw,E))+'px');
const s9Raw=clamp((s9-0.75)/0.25,0,1); root.style.setProperty('--s9Y', (s9StartY +(s9EndY -s9StartY )*easePow(s9Raw,E))+'px');
const s11Raw=clamp((s11-0.75)/0.25,0,1); root.style.setProperty('--s11Y',(s11StartY+(s11EndY-s11StartY)*easePow(s11Raw,E))+'px');
const s13Raw=clamp((s13-0.75)/0.25,0,1); root.style.setProperty('--s13Y',(s13StartY+(s13EndY-s13StartY)*easePow(s13Raw,E))+'px');
const s14Raw=clamp((s14-0.25)/0.75,0,1); root.style.setProperty('--s14Y',(s14StartY+(s14EndY-s14StartY)*easePow(s14Raw,E))+'px');

/* S15 timing */
const s15Raw=clamp((s15-0.25)/0.75,0,1);
root.style.setProperty('--s15Y',(s15StartY+(s15EndY-s15StartY)*easePow(s15Raw,E))+'px');

/* End zooms (full-bleed S3, S8, S12, S15) */
const s3ZoomRaw = clamp((s3 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s3Scale', (1 + 0.15 * s3ZoomRaw).toFixed(3));
const s8ZoomRaw = clamp((s8 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s8Scale', (1 + 0.15 * s8ZoomRaw).toFixed(3));
const s12ZoomRaw = clamp((s12 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s12Scale', (1 + 0.15 * s12ZoomRaw).toFixed(3));
const s15ZoomRaw = clamp((s15 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s15Scale', (1 + 0.15 * s15ZoomRaw).toFixed(3));


/* Fade timings: Image fades in during the first 25% of the driver, fades out in the last 25% */
const T_IN = 0.25;
const T_OUT = 0.75;
const s1Alpha = clamp(s1 / T_IN, 0, 1) * clamp((1-s1)/(1-T_OUT), 0, 1);
const s2Alpha = clamp(s2 / T_IN, 0, 1) * clamp((1-s2)/(1-T_OUT), 0, 1);
const sGeddesAlpha = clamp(sGeddes / T_IN, 0, 1) * clamp((1-sGeddes)/(1-T_OUT), 0, 1);
const s4Alpha = clamp(s4 / T_IN, 0, 1) * clamp((1-s4)/(1-T_OUT), 0, 1);
const s5Alpha = clamp(s5 / T_IN, 0, 1) * clamp((1-s5)/(1-T_OUT), 0, 1);
const s9Alpha = clamp(s9 / T_IN, 0, 1) * clamp((1-s9)/(1-T_OUT), 0, 1);
const s11Alpha = clamp(s11 / T_IN, 0, 1) * clamp((1-s11)/(1-T_OUT), 0, 1);
const s13Alpha = clamp(s13 / T_IN, 0, 1) * clamp((1-s13)/(1-T_OUT), 0, 1);
const s14Alpha = clamp(s14 / T_IN, 0, 1) * clamp((1-s14)/(1-T_OUT), 0, 1);

/* Full-bleed sections (In: 15% -> 25%, Out: 90% -> 100%) */
const s3AlphaIn = clamp((s3 - 0.15) / 0.10, 0, 1); 
const s3AlphaOut = s3AlphaIn * clamp((1-s3)/(1-0.90), 0, 1); 

const s8AlphaIn = clamp((s8 - 0.15) / 0.10, 0, 1); 
const s8AlphaOut = s8AlphaIn * clamp((1-s8)/(1-0.90), 0, 1); 

const s12AlphaIn = clamp((s12 - 0.15) / 0.10, 0, 1); 
const s12AlphaOut = s12AlphaIn * clamp((1-s12)/(1-0.90), 0, 1); 

const s15Group = clamp((s15 - 0.15) / 0.10, 0, 1); 
const s15AlphaOut = s15Group * clamp((1-s15)/(1-0.90), 0, 1); 


/* Map section (sMapA) timing (In: 5% -> 15%, Out: 90% -> 100%) */
const sMapAAlphaIn = clamp((sMapA - 0.05) / 0.10, 0, 1); 
const sMapAAlphaOut = sMapAAlphaIn * clamp((1-sMapA)/(1-0.90), 0, 1); 


/* Gallery A: Four images, 25% per image, fades in (0-5%), fades out (95-100%) */
const galAStart=0.05, galADur=0.90;
const galAD1 = clamp((galA - galAStart) / (galADur * 0.25), 0, 1);
const galAD2 = clamp((galA - (galAStart + galADur * 0.25)) / (galADur * 0.25), 0, 1);
const galAD3 = clamp((galA - (galAStart + galADur * 0.50)) / (galADur * 0.25), 0, 1);
const galAD4 = clamp((galA - (galAStart + galADur * 0.75)) / (galADur * 0.25), 0, 1);

const galAFadeOut = clamp((1-galA)/(1-0.95), 0, 1);
root.style.setProperty('--galAImg0Opacity', ((1 - galAD1) * galAFadeOut).toFixed(3));
root.style.setProperty('--galAImg1Opacity', (galAD1 * (1 - galAD2) * galAFadeOut).toFixed(3));
root.style.setProperty('--galAImg2Opacity', (galAD2 * (1 - galAD3) * galAFadeOut).toFixed(3));
root.style.setProperty('--galAImg3Opacity', (galAD3 * (1 - galAD4) * galAFadeOut).toFixed(3));


/* Gallery B: Five images, 20% per image, fades in (0-5%), fades out (95-100%) */
const galBStart=0.05, galBDur=0.90;
const galBD1 = clamp((galB - galBStart) / (galBDur * 0.20), 0, 1);
const galBD2 = clamp((galB - (galBStart + galBDur * 0.20)) / (galBDur * 0.20), 0, 1);
const galBD3 = clamp((galB - (galBStart + galBDur * 0.40)) / (galBDur * 0.20), 0, 1);
const galBD4 = clamp((galB - (galBStart + galBDur * 0.60)) / (galBDur * 0.20), 0, 1);
const galBD5 = clamp((galB - (galBStart + galBDur * 0.80)) / (galBDur * 0.20), 0, 1);

const galBFadeOut = clamp((1-galB)/(1-0.95), 0, 1);
root.style.setProperty('--galBImg0Opacity', ((1 - galBD1) * galBFadeOut).toFixed(3));
root.style.setProperty('--galBImg1Opacity', (galBD1 * (1 - galBD2) * galBFadeOut).toFixed(3));
root.style.setProperty('--galBImg2Opacity', (galBD2 * (1 - galBD3) * galBFadeOut).toFixed(3));
root.style.setProperty('--galBImg3Opacity', (galBD3 * (1 - galBD4) * galBFadeOut).toFixed(3));
root.style.setProperty('--galBImg4Opacity', (galBD4 * (1 - galBD5) * galBFadeOut).toFixed(3));

/* Gallery C: Six images, 16.66% per image, fades in (0-5%), fades out (95-100%) */
const galCStart=0.05, galCDur=0.90;
const galCD1 = clamp((galC - galCStart) / (galCDur * 0.16666), 0, 1);
const galCD2 = clamp((galC - (galCStart + galCDur * 0.16666)) / (galCDur * 0.16666), 0, 1);
const galCD3 = clamp((galC - (galCStart + galCDur * 0.33332)) / (galCDur * 0.16666), 0, 1);
const galCD4 = clamp((galC - (galCStart + galCDur * 0.49998)) / (galCDur * 0.16666), 0, 1);
const galCD5 = clamp((galC - (galCStart + galCDur * 0.66664)) / (galCDur * 0.16666), 0, 1);
const galCD6 = clamp((galC - (galCStart + galCDur * 0.83330)) / (galCDur * 0.16666), 0, 1);

const galCFadeOut = clamp((1-galC)/(1-0.95), 0, 1);
root.style.setProperty('--galCImg0Opacity', ((1 - galCD1) * galCFadeOut).toFixed(3));
root.style.setProperty('--galCImg1Opacity', (galCD1 * (1 - galCD2) * galCFadeOut).toFixed(3));
root.style.setProperty('--galCImg2Opacity', (galCD2 * (1 - galCD3) * galCFadeOut).toFixed(3));
root.style.setProperty('--galCImg3Opacity', (galCD3 * (1 - galCD4) * galCFadeOut).toFixed(3));
root.style.setProperty('--galCImg4Opacity', (galCD4 * (1 - galCD5) * galCFadeOut).toFixed(3));
root.style.setProperty('--galCImg5Opacity', (galCD5 * (1 - galCD6) * galCFadeOut).toFixed(3));

/* Set final image opacities for image-text sections */
root.style.setProperty('--s1ImgOpacity', s1Alpha.toFixed(3));
root.style.setProperty('--s2ImgOpacity', s2Alpha.toFixed(3));
root.style.setProperty('--sGeddesImgOpacity', sGeddesAlpha.toFixed(3));
root.style.setProperty('--s3ImgOpacity', s3AlphaOut.toFixed(3));
root.style.setProperty('--s4ImgOpacity', s4Alpha.toFixed(3));
root.style.setProperty('--sMapAImgOpacity', sMapAAlphaOut.toFixed(3));
root.style.setProperty('--s5ImgOpacity', s5Alpha.toFixed(3));
root.style.setProperty('--s8ImgOpacity', s8AlphaOut.toFixed(3));
root.style.setProperty('--s9ImgOpacity', s9Alpha.toFixed(3));
root.style.setProperty('--s11ImgOpacity', s11Alpha.toFixed(3));
root.style.setProperty('--s12ImgOpacity', s12AlphaOut.toFixed(3));
root.style.setProperty('--s13ImgOpacity', s13Alpha.toFixed(3));
root.style.setProperty('--s14ImgOpacity', s14Alpha.toFixed(3));
root.style.setProperty('--s15ImgOpacity', s15AlphaOut.toFixed(3));

requestAnimationFrame(update);
}

async function init(){
if(document.fonts && document.fonts.ready){ try{ await document.fonts.ready; }catch(e){} }
measureHero();
measureS1(); measureS2(); measureSGeddes(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15();
update();
addEventListener('load',  ()=>{ measureHero(); measureS1(); measureS2(); measureSGeddes(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15(); });
addEventListener('resize',()=>{ measureHero(); measureS1(); measureS2(); measureSGeddes(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15(); });
}

init();
})();
</script>


<script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script><script>
mapboxgl.accessToken = 'pk.eyJ1Ijoia2F2bmkiLCJhIjoiY2s5YjBqNGY1MGV4aTNobnk0amJncWZweCJ9.gZK_r9CYmb6ZN_mZVmgjNg';
const MAP_START_CENTER = [34.770081, 32.079031];
const MAP_START_ZOOM = 15.99;
const mapFrame = document.querySelector('.sMapA-frame');
const mapContainer = document.getElementById('mapA-container');
const mapSection = document.querySelector('#mapSection'); // This targets the <figure>
const exitBtn = document.getElementById("exit-map-button");

// Initialize Mapbox map
const map = new mapboxgl.Map({
    container: 'mapA-container',
    // *** CORRECTED STYLE URL ***
    style: 'mapbox://styles/kavni/cmhkpt4uz00et01pjheur1zc1', 
    center: MAP_START_CENTER,
    zoom: MAP_START_ZOOM,
    interactive: false
});

map.on('load', () => {
    map.scrollZoom.disable();
    map.dragPan.disable();
    map.doubleClickZoom.disable();
    map.touchZoomRotate.disable();
});

// Enable/Disable map interactions based on scroll position
function toggleMapPointer() {
    // Check against the driver section's scroll position (sMapA-wrap)
    const mapSectionDriver = document.getElementById('sMapA-wrap');
    if (!mapSectionDriver) return;

    const rect = mapSectionDriver.getBoundingClientRect();
    const visible = rect.top < window.innerHeight * 0.8 &&
                    rect.bottom > window.innerHeight * 0.2;

    if (visible) {
        mapFrame.classList.add('active');
        map.dragPan.enable();
        map.doubleClickZoom.enable();
        map.touchZoomRotate.enable();
    } else {
        mapFrame.classList.remove('active');
        map.scrollZoom.disable();
        map.dragPan.disable();
        map.doubleClickZoom.disable();
        map.touchZoomRotate.disable();
    }
}

// Mouse leave → give scroll back to page (Crucial for scrollytelling handover)
mapContainer.addEventListener('mouseleave', () => map.scrollZoom.disable());
mapContainer.addEventListener('mouseenter', () => {
    const mapSectionDriver = document.getElementById('sMapA-wrap');
    const rect = mapSectionDriver.getBoundingClientRect();
    const visible = rect.top < window.innerHeight * 0.8 &&
                    rect.bottom > window.innerHeight * 0.2;
    // Only enable map scroll if the map section is currently visible on the screen
    if (visible) map.scrollZoom.enable();
});

// EXIT MAP button
exitBtn.addEventListener("click", () => {
  mapContainer.style.pointerEvents = "none";
  window.scrollBy({ top: window.innerHeight * 0.6, behavior: "smooth" });
});

window.addEventListener('scroll', toggleMapPointer, { passive: true });
window.addEventListener('resize', toggleMapPointer);
toggleMapPointer();
</script>

</body>
</html>
