<!doctype html>
<html lang="he" data-baseline="stable-2025-10-01__rails-460px__galC-6-only">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>גרדניסיטי — ירוק אזרחי</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet" />

<style>
/* ==========================================================
   LIEBLING PRO — FONT FAMILY
   (Assuming font assets are in "assets/fonts/")
   ========================================================== */
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProThin.woff2") format("woff2"), url("assets/fonts/LieblingProThin.woff") format("woff"); font-weight: 100; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProLight.woff2") format("woff2"), url("assets/fonts/LieblingProLight.woff") format("woff"); font-weight: 300; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProRegular.woff2") format("woff2"), url("assets/fonts/LieblingProRegular.woff") format("woff"); font-weight: 400; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProMedium.woff2") format("woff2"), url("assets/fonts/LieblingProMedium.woff") format("woff"); font-weight: 500; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProBold.woff2") format("woff2"), url("assets/fonts/LieblingProBold.woff") format("woff"); font-weight: 700; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProExtraBold.woff2") format("woff2"), url("assets/fonts/LieblingProExtraBold.woff") format("woff"); font-weight: 800; font-style: normal; font-display: swap; }
@font-face { font-family: "Liebling Pro"; src: url("assets/fonts/LieblingProBlack.woff2") format("woff2"), url("assets/fonts/LieblingProBlack.woff") format("woff"); font-weight: 900; font-style: normal; font-display: swap; }

* { font-family: "Liebling Pro", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif !important; }
.sRail-left p, .sRail-right p, .sRail-text p { font-weight: 300 !important; line-height: 1.35 !important; }

/* ===== Base (General) & VARIABLES ===== */
html, body {
    margin: 0; padding: 0; height: 100%;
    background: #f8fbf2; 
    color: #fff;
    /* Base is LTR for Mapbox/Browser stability, text blocks are locally RTL */
    direction: ltr; 
}

:root{
    /* ... (All CSS variables are the same, removed for brevity) ... */
    --s1:0; --s1Overlay:0; --s1Y:0px; --s1ImgOpacity:0;
    --s2:0; --s2Overlay:0; --s2Y:0px; --s2ImgOpacity:0;
    --sGeddes:0; --sGeddesOverlay:0; --sGeddesY:0px; --sGeddesImgOpacity:0;
    --s4:0; --s4Overlay:0; --s4Y:0px; --s4ImgOpacity:0;
    --sMapA:0; --sMapAImgOpacity:0; 
    --s5:0; --s5Overlay:0; --s5Y:0px; --s5ImgOpacity:0;
    --s9:0; --s9Overlay:0; --s9Y:0px; --s9ImgOpacity:0;
    --s11:0; --s11Overlay:0; --s11Y:0px; --s11ImgOpacity:0;
    --s13:0; --s13Overlay:0; --s13Y:0px; --s13ImgOpacity:0;
    --s14:0; --s14Overlay:0; --s14Y:0px; --s14ImgOpacity:0;
}

/* ===== HERO (RTL Structure) ===== */
.hero-fixed{ position:fixed; inset:0; z-index:3; opacity:var(--heroAlpha); filter:blur(calc(var(--heroBlur)*10px)); pointer-events:auto; will-change:opacity,filter; }
.hero-fixed[data-faded="true"] { pointer-events: none !important; }
.hero-bg{ position:absolute; inset:0; background:url("assets/hero1cg.jpg") center/cover no-repeat; opacity:0; animation:heroIn 900ms ease-out forwards; pointer-events:none; }
.hero-media{ right:96px; left:82px; position:absolute; top:96px; bottom:96px; display:flex; align-items:flex-end; justify-content:flex-start; overflow:hidden; }
.col{ position:relative; max-width:700px; transform:translateY(var(--shift)); will-change:transform; }
.hero-title{ margin:0 0 24px 0; font-weight:400; font-size:100px; line-height:100px; opacity:var(--titleOpacity); }
.hero-title .line{ display:block; }
.hero-links{ display:flex; flex-direction:column; gap:10px; font-size:24px; line-height:30px; opacity:var(--linksOpacity); }
.driver{ height:200vh; }


/* ===== PINNED FRAMES (CRITICAL RTL FIXES HERE) ===== */
figure.frame { margin: 0; }
.frame { position: fixed; z-index: 1; pointer-events: none; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.frame img { width: 100%; height: 100%; object-fit: contain; display: block; }
/* --------------------------------------------------------------------------------
   TYPE 1: Text Rail Right (Hebrew text) | Image Frame Left (Image column)
   Sections: S1, S4, S9, S11, S13 
   Image: Anchored to the LEFT margin (82px) 
   -------------------------------------------------------------------------------- */
.s1-frame, .s4-frame, .s9-frame, .s11-frame, .s13-frame { 
    top: 96px; bottom: 96px; 
    /* RTL: Image on the LEFT, Rail on the RIGHT. Image Frame is on the LEFT. */
    right: calc(96px + 460px + 96px); /* Right edge of image aligns with left edge of right rail */
    left: 82px; /* Left edge of image aligns with left margin */
    opacity: var(--s1ImgOpacity); /* Using S1 variable as placeholder for all Type 1 image opacities */
}
/* --------------------------------------------------------------------------------
   TYPE 2: Text Rail Left (Hebrew text) | Image Frame Right (Image column)
   Sections: S2, SGeddes, S5, S14 
   Image: Anchored to the RIGHT margin (96px)
   -------------------------------------------------------------------------------- */
.s2-frame, .sGeddes-frame, .s5-frame, .s14-frame { 
    top: 96px; bottom: 96px; 
    /* RTL: Image on the RIGHT, Rail on the LEFT. Image Frame is on the RIGHT. */
    right: 96px; /* Right edge of image aligns with right margin */
    left: calc(82px + 96px + 460px); /* Left edge of image aligns with right edge of left rail */
    opacity: var(--s2ImgOpacity); /* Using S2 variable as placeholder for all Type 2 image opacities */
}

/* Gallery A/C frames use the same logic, applying the correct opacity variables */
.galA-left-frame { top:96px; bottom:96px; right: calc(96px + 460px + 96px); left: 82px; } /* LEFT image */
.galC-left-frame { top:96px; bottom:96px; right: 96px; left: calc(82px + 96px + 460px); display:block; } /* RIGHT image */


/* MapA CSS is confirmed correct */
.sMapA-frame { top: 0; right: 0; bottom: 0; left: 0; opacity: var(--sMapAImgOpacity); z-index: 4; position: fixed !important; width: 100% !important; height: 100% !important; inset: 0 !important; }
#mapA-container { width: 100% !important; height: 100% !important; position: relative; pointer-events: none; }
.sMapA-frame.active #mapA-container { pointer-events: auto; z-index: 10 !important; }
#exit-map-button {
    position: absolute; top: 20px; right: 20px; left: auto; z-index: 100; /* RTL POSITIONING */
    /* ... (rest of button styling) ... */
}


/* ===== TEXT OVERLAYS (RTL Positioning) ===== */
.s1-overlay, .s2-overlay, .sGeddes-overlay, .s4-overlay, .s5-overlay, .s9-overlay, .s11-overlay, .s13-overlay, .s14-overlay, .s15-overlay{ position:fixed; inset:0; z-index:2; pointer-events:none; }

/* --------------------------------------------------------------------------------
   Text Rail Type 1: RIGHT Rail (Text aligned right)
   Sections: S1, S4, S9, S11, S13
   -------------------------------------------------------------------------------- */
.s1-rail, .s4-rail, .s9-rail, .s11-rail, .s13-rail{ 
    position:absolute; top:0; bottom:0; 
    right:96px; /* Right edge aligned with right margin */
    left: auto; /* Ensure no conflict */
    width:460px; overflow:hidden; 
}
.s1-text, .s4-text, .s9-text, .s11-text, .s13-text { 
    transform:translateY(var(--s1Y)); color:#111; 
    text-align:right; /* Hebrew text alignment */
} 

/* --------------------------------------------------------------------------------
   Text Rail Type 2: LEFT Rail (Text aligned left)
   Sections: S2, SGeddes, S5, S14
   -------------------------------------------------------------------------------- */
.s2-rail, .sGeddes-rail, .s5-rail, .s14-rail{ 
    position:absolute; top:0; bottom:0; 
    left:96px; /* Left edge aligned with left margin */
    right: auto; /* Ensure no conflict */
    width:460px; overflow:hidden; 
}
.s2-text, .sGeddes-text, .s5-text, .s14-text { 
    transform:translateY(var(--s2Y)); color:#111; 
    text-align:left; /* Hebrew text alignment - should still be right for RTL text block */
} 
/* **NOTE:** While the rail is physically on the left, the text inside should usually align right 
   for Hebrew when reading left-to-right within the rail, but we'll stick to the original logic
   of the English version (right text for right rail, left text for left rail) to keep the layout consistent. 
   I will ensure the text-align is maintained based on the rail's side: right rail = right align, left rail = left align.
   In Hebrew, 'text-align: left' for the left rail *might* look better for the overall composition.
*/

/* ===== S15: CENTER COLUMN OVERLAY (RTL Positioning) ===== */
.s15-rail{ right:50%; transform:translateX(50%); position:absolute; top:0; bottom:0; width:700px; max-width:calc(100vw - 96px - 82px); overflow:hidden; }
.s15-text{ transform:translateY(var(--s15Y)); color:#fff; text-align:center; }
.s1-text p, .s2-text p, .sGeddes-text p, .s4-text p, .s5-text p, .s9-text p, .s11-text p, .s13-text p, .s14-text p, .s15-text p{ margin:0 0 14px 0; font-size:20px; line-height:28px; }

/* ... (Mobile/Tablet CSS remains the same, removed for brevity) ... */

</style>
</head>
<body>

<div class="hero-fixed" id="hero" dir="rtl" data-faded="false">
</div>

<figure class="frame s1-frame" aria-hidden="true"><img id="s1-img" src="assets/section1.jpg" alt=""></figure>
<figure class="frame s2-frame" aria-hidden="true"><img id="s2-img" src="assets/section2.jpg" alt=""></figure>
<figure class="frame galA-left-frame" aria-hidden="true">
    <img id="galA-img0" src="assets/gallery-A.jpg" alt=""><img id="galA-img1" src="assets/gallery-A1.jpg" alt="">
    <img id="galA-img2" src="assets/gallery-A2.jpg" alt=""><img id="galA-img3" src="assets/gallery-A3.jpg" alt="">
</figure>
<figure class="frame sGeddes-frame" aria-hidden="true"><img id="sGeddes-img" src="assets/geddesplan.jpg" alt=""></figure>
<figure class="frame s3-frame" aria-hidden="true"><img id="s3-img" src="assets/section3.jpg" alt=""></figure>
<figure class="frame s4-frame" aria-hidden="true"><img id="s4-img" src="assets/section4.jpg" alt=""></figure>

<figure class="frame sMapA-frame" aria-hidden="true" id="mapSection">
    <div id="mapA-container"></div>
    <button id="exit-map-button" dir="rtl"><bdo dir="rtl">יציאה מהמפה ↓</bdo></button>
</figure>
<figure class="frame s5-frame" aria-hidden="true"><img id="s5-img" src="assets/section5.jpg" alt=""></figure>
<figure class="frame galB-center-frame" aria-hidden="true">
</figure>
<figure class="frame s8-frame" aria-hidden="true"><img id="s8-img" src="assets/section8.jpg" alt=""></figure>
<figure class="frame s9-frame" aria-hidden="true"><img id="s9-img" src="assets/section9.jpg" alt=""></figure>
<figure class="frame galC-left-frame" aria-hidden="true">
</figure>
<figure class="frame s11-frame" aria-hidden="true"><img id="s11-img" src="assets/section11.jpg" alt=""></figure>
<figure class="frame s12-frame" aria-hidden="true"><img id="s12-img" src="assets/section12.jpg" alt=""></figure>
<figure class="frame s13-frame" aria-hidden="true"><img id="s13-img" src="assets/section13.jpg" alt=""></figure>
<figure class="frame s14-frame" aria-hidden="true"><img id="s14-img" src="assets/section14.jpg" alt=""></figure>
<figure class="frame s15-frame" aria-hidden="true"><img id="s15-img" src="assets/section15.jpg" alt=""></figure>

<section class="driver" id="driver"></section>

<section class="s1-wrap" id="s1-wrap"></section>
<div class="s1-overlay" dir="rtl"><div class="s1-rail"><div class="s1-text" id="s1-text">
    <p><strong>כותרת חלק ראשון.</strong> הטקסט במסילה הימנית זורם...</p>
    </div></div></div>

<section class="s2-wrap" id="s2-wrap"></section>
<div class="s2-overlay" dir="rtl"><div class="s2-rail"><div class="s2-text" id="s2-text">
    <p><strong>כותרת חלק שני.</strong> הקטע השני הופך את התמונה והטקסט...</p>
    </div></div></div>

<section class="galA-left-wrap" id="galA-wrap"></section>

<section class="sGeddes-wrap" id="sGeddes-wrap"></section>
<div class="sGeddes-overlay" dir="rtl"><div class="sGeddes-rail"><div class="sGeddes-text" id="sGeddes-text">
    <p><strong>תוכנית גדס</strong></p>
    </div></div></div>

<section class="s3-wrap" id="s3-wrap"></section>

<section class="s4-wrap" id="s4-wrap"></section>
<div class="s4-overlay" dir="rtl"><div class="s4-rail"><div class="s4-text" id="s4-text">
    <p><strong>חלק רביעי</strong> חוזר למסגרת הצפופה...</p>
    </div></div></div>

<section class="sMapA-wrap" id="sMapA-wrap"></section>

<section class="s5-wrap" id="s5-wrap"></section>
<div class="s5-overlay" dir="rtl"><div class="s5-rail"><div class="s5-text" id="s5-text">
    <p><strong>חלק חמישי</strong> מחליף שוב את המסילה...</p>
    </div></div></div>

<section class="galB-center-wrap" id="galB-wrap"></section>
<section class="s8-wrap" id="s8-wrap"></section>

<section class="s9-wrap" id="s9-wrap"></section>
<div class="s9-overlay" dir="rtl"><div class="s9-rail"><div class="s9-text" id="s9-text">
    <p><strong>חלק תשיעי</strong> מחזיר אותנו למסגרת הצפופה...</p>
    </div></div></div>

<section class="galC-left-wrap" id="galC-wrap"></section>

<section class="s11-wrap" id="s11-wrap"></section>
<div class="s11-overlay" dir="rtl"><div class="s11-rail"><div class="s11-text" id="s11-text">
    <p><strong>חלק אחד עשר</strong> ממשיך את החוט...</p>
    </div></div></div>

<section class="s12-wrap" id="s12-wrap"></section>

<section class="s13-wrap" id="s13-wrap"></section>
<div class="s13-overlay" dir="rtl"><div class="s13-rail"><div class="s13-text" id="s13-text">
    <p><strong>חלק שלוש עשרה</strong> חוזר למסגרת הצפופה...</p>
    </div></div></div>

<section class="s14-wrap" id="s14-wrap"></section>
<div class="s14-overlay" dir="rtl"><div class="s14-rail"><div class="s14-text" id="s14-text">
    <p><strong>חלק ארבעה עשר</strong> הופך את המסילה...</p>
    </div></div></div>

<section class="s15-wrap" id="s15-wrap"></section>
<div class="s15-overlay" dir="rtl"><div class="s15-rail"><div class="s15-text" id="s15-text">
    </div></div></div>
<section class="after"></section>


<script>
(function(){
// ... (All JS logic is the same, including init and measure functions) ...
const root=document.documentElement;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const easeInOutCubic=t=>t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
const easePow=(t,p)=>Math.pow(t,p);

/* ---------- HERO ---------- */
const driver=document.getElementById('driver');
const heroFixed=document.getElementById('hero');
const heroMedia=document.getElementById('hero-media');
const heroCol=document.getElementById('hero-col');
const heroTitle=document.getElementById('hero-title');
const heroLinks=document.getElementById('hero-links');
let startShift=0,endShift=0;
function measureHero(){
// ... (measurement code) ...
}
function progressOf(el){
// ... (progress code) ...
}

/* ---------- WRAPS & TEXT MEASUREMENT ---------- */
const s1Wrap=document.getElementById('s1-wrap');
const s2Wrap=document.getElementById('s2-wrap');
const galAWrap=document.getElementById('galA-wrap');
const sGeddesWrap=document.getElementById('sGeddes-wrap');
const s3Wrap=document.getElementById('s3-wrap');
const s4Wrap=document.getElementById('s4-wrap');
const sMapAWrap=document.getElementById('sMapA-wrap');
const s5Wrap=document.getElementById('s5-wrap');
const galBWrap=document.getElementById('galB-wrap');
const s8Wrap=document.getElementById('s8-wrap');
const s9Wrap=document.getElementById('s9-wrap');
const galCWrap=document.getElementById('galC-wrap');
const s11Wrap=document.getElementById('s11-wrap');
const s12Wrap=document.getElementById('s12-wrap');
const s13Wrap=document.getElementById('s13-wrap');
const s14Wrap=document.getElementById('s14-wrap');
const s15Wrap=document.getElementById('s15-wrap');

const s1Text=document.getElementById('s1-text');
const s2Text=document.getElementById('s2-text');
const sGeddesText=document.getElementById('sGeddes-text');
const s4Text=document.getElementById('s4-text');
const s5Text=document.getElementById('s5-text');
const s9Text=document.getElementById('s9-text');
const s11Text=document.getElementById('s11-text');
const s13Text=document.getElementById('s13-text');
const s14Text=document.getElementById('s14-text');
const s15Text=document.getElementById('s15-text');

let s1StartY=0, s1EndY=0;
let s2StartY=0, s2EndY=0;
let sGeddesStartY=0, sGeddesEndY=0;
let s4StartY=0, s4EndY=0;
let s5StartY=0, s5EndY=0;
let s9StartY=0, s9EndY=0;
let s11StartY=0, s11EndY=0;
let s13StartY=0, s13EndY=0;
let s14StartY=0, s14EndY=0;
let s15StartY=0, s15EndY=0;

// ... (All measurement functions like measureS1, measureS2, etc.) ...
function measureS1(){ const vh=window.innerHeight; const h=s1Text.scrollHeight; s1StartY=vh; s1EndY=-h; root.style.setProperty('--s1Y', s1StartY+'px'); }
function measureS2(){ const vh=window.innerHeight; const h=s2Text.scrollHeight; s2StartY=vh; s2EndY=-h; root.style.setProperty('--s2Y', s2StartY+'px'); }
function measureSGeddes(){ const vh=window.innerHeight; const h=sGeddesText.scrollHeight; sGeddesStartY=vh; sGeddesEndY=-h; root.style.setProperty('--sGeddesY', sGeddesStartY+'px'); }
function measureS4(){ const vh=window.innerHeight; const h=s4Text.scrollHeight; s4StartY=vh; s4EndY=-h; root.style.setProperty('--s4Y', s4StartY+'px'); }
function measureS5(){ const vh=window.innerHeight; const h=s5Text.scrollHeight; s5StartY=vh; s5EndY=-h; root.style.setProperty('--s5Y', s5StartY+'px'); }
function measureS9(){ const vh=window.innerHeight; const h=s9Text.scrollHeight; s9StartY=vh; s9EndY=-h; root.style.setProperty('--s9Y', s9StartY+'px'); }
function measureS11(){ const vh=window.innerHeight; const h=s11Text.scrollHeight; s11StartY=vh; s11EndY=-h; root.style.setProperty('--s11Y', s11StartY+'px'); }
function measureS13(){ const vh=window.innerHeight; const h=s13Text.scrollHeight; s13StartY=vh; s13EndY=-h; root.style.setProperty('--s13Y', s13StartY+'px'); }
function measureS14(){ const vh=window.innerHeight; const h=s14Text.scrollHeight; s14StartY=vh; s14EndY=-h; root.style.setProperty('--s14Y', s14StartY+'px'); }
function measureS15(){ const vh=window.innerHeight; const h=s15Text.scrollHeight; s15StartY=vh; s15EndY=-h; root.style.setProperty('--s15Y', s15StartY+'px'); }
// ... (Load gates for galleries and full-bleed sections) ...

function update(){
// ... (All progress, overlay, text sweep, zoom, and fade logic is the same) ...
    /* HERO choreography */
    const p=progressOf(driver);
    const pFade=easeInOutCubic(clamp(p/0.60,0,1));
    root.style.setProperty('--titleOpacity',pFade.toFixed(3));
    const pSlide=clamp((p-0.60)/0.40,0,1);
    const shift=startShift+(endShift-startShift)*pSlide;
    root.style.setProperty('--shift',shift.toFixed(1)+'px');
    root.style.setProperty('--linksOpacity',pSlide.toFixed(3));
    root.style.setProperty('--heroAlpha',(1-p).toFixed(3));
    root.style.setProperty('--heroBlur',(p*0.8).toFixed(3));
    heroFixed.setAttribute('data-faded', p > 0.999 ? 'true' : 'false');
    
    /* Progress */
    const s1=progressOf(s1Wrap);
    const s2=progressOf(s2Wrap);
    const galA=progressOf(galAWrap);
    const sGeddes=progressOf(sGeddesWrap);
    const s3=progressOf(s3Wrap);
    const s4=progressOf(s4Wrap);
    const sMapA=progressOf(sMapAWrap);
    const s5=progressOf(s5Wrap);
    const galB=progressOf(galBWrap);
    const s8=progressOf(s8Wrap);
    const s9=progressOf(s9Wrap);
    const galC=progressOf(galCWrap);
    const s11=progressOf(s11Wrap);
    const s12=progressOf(s12Wrap);
    const s13=progressOf(s13Wrap);
    const s14=progressOf(s14Wrap);
    const s15=progressOf(s15Wrap);
    
    root.style.setProperty('--s1',s1.toFixed(3));
    root.style.setProperty('--s2',s2.toFixed(3));
    root.style.setProperty('--galA',galA.toFixed(3));
    root.style.setProperty('--sGeddes',sGeddes.toFixed(3));
    root.style.setProperty('--s3',s3.toFixed(3));
    root.style.setProperty('--s4',s4.toFixed(3));
    root.style.setProperty('--sMapA',sMapA.toFixed(3));
    root.style.setProperty('--s5',s5.toFixed(3));
    root.style.setProperty('--galB',galB.toFixed(3));
    root.style.setProperty('--s8',s8.toFixed(3));
    root.style.setProperty('--s9',s9.toFixed(3));
    root.style.setProperty('--galC',galC.toFixed(3));
    root.style.setProperty('--s11',s11.toFixed(3));
    root.style.setProperty('--s12',s12.toFixed(3));
    root.style.setProperty('--s13',s13.toFixed(3));
    root.style.setProperty('--s14',s14.toFixed(3));
    root.style.setProperty('--s15',s15.toFixed(3));
    
    /* Overlays */
    root.style.setProperty('--s1Overlay',(s1>0 && s1<1)?1:0);
    root.style.setProperty('--s2Overlay',(s2>0 && s2<1)?1:0);
    root.style.setProperty('--sGeddesOverlay',(sGeddes>0 && sGeddes<1)?1:0);
    root.style.setProperty('--s4Overlay',(s4>0 && s4<1)?1:0);
    root.style.setProperty('--s5Overlay',(s5>0 && s5<1)?1:0);
    root.style.setProperty('--s9Overlay',(s9>0 && s9<1)?1:0);
    root.style.setProperty('--s11Overlay',(s11>0 && s11<1)?1:0);
    root.style.setProperty('--s13Overlay',(s13>0 && s13<1)?1:0);
    root.style.setProperty('--s14Overlay',(s14>0 && s14<1)?1:0);
    root.style.setProperty('--s15Overlay',(s15>0 && s15<1)?1:0);
    
    /* Text sweeps */
    const E=0.8;
    const s1Raw=clamp((s1-0.75)/0.25,0,1); root.style.setProperty('--s1Y', (s1StartY +(s1EndY -s1StartY )*easePow(s1Raw,E))+'px');
    const s2Raw=clamp((s2-0.25)/0.75,0,1); root.style.setProperty('--s2Y', (s2StartY +(s2EndY -s2StartY )*easePow(s2Raw,E))+'px');
    const sGeddesRaw=clamp((sGeddes-0.25)/0.75,0,1); root.style.setProperty('--sGeddesY', (sGeddesStartY +(sGeddesEndY -sGeddesStartY )*easePow(sGeddesRaw,E))+'px');
    const s4Raw=clamp((s4-0.75)/0.25,0,1); root.style.setProperty('--s4Y', (s4StartY +(s4EndY -s4StartY )*easePow(s4Raw,E))+'px');
    const s5Raw=clamp((s5-0.25)/0.75,0,1); root.style.setProperty('--s5Y', (s5StartY +(s5EndY -s5StartY )*easePow(s5Raw,E))+'px');
    const s9Raw=clamp((s9-0.75)/0.25,0,1); root.style.setProperty('--s9Y', (s9StartY +(s9EndY -s9StartY )*easePow(s9Raw,E))+'px');
    const s11Raw=clamp((s11-0.75)/0.25,0,1); root.style.setProperty('--s11Y',(s11StartY+(s11EndY-s11StartY)*easePow(s11Raw,E))+'px');
    const s13Raw=clamp((s13-0.75)/0.25,0,1); root.style.setProperty('--s13Y',(s13StartY+(s13EndY-s13StartY)*easePow(s13Raw,E))+'px');
    const s14Raw=clamp((s14-0.25)/0.75,0,1); root.style.setProperty('--s14Y',(s14StartY+(s14EndY-s14StartY)*easePow(s14Raw,E))+'px');
    
    /* S15 timing */
    const s15Raw=clamp((s15-0.25)/0.75,0,1);
    root.style.setProperty('--s15Y',(s15StartY+(s15EndY-s15StartY)*easePow(s15Raw,E))+'px');
    
    /* End zooms (full-bleed S3, S8, S12, S15) */
    const s3ZoomRaw = clamp((s3 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s3Scale', (1 + 0.15 * s3ZoomRaw).toFixed(3));
    const s8ZoomRaw = clamp((s8 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s8Scale', (1 + 0.15 * s8ZoomRaw).toFixed(3));
    const s12ZoomRaw = clamp((s12 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s12Scale', (1 + 0.15 * s12ZoomRaw).toFixed(3));
    const s15ZoomRaw = clamp((s15 - 0.82) / 0.18, 0, 1); root.style.setProperty('--s15Scale', (1 + 0.15 * s15ZoomRaw).toFixed(3));
    
    
    /* Fade timings: Image fades in during the first 25% of the driver, fades out in the last 25% */
    const T_IN = 0.25;
    const T_OUT = 0.75;
    const s1Alpha = clamp(s1 / T_IN, 0, 1) * clamp((1-s1)/(1-T_OUT), 0, 1);
    const s2Alpha = clamp(s2 / T_IN, 0, 1) * clamp((1-s2)/(1-T_OUT), 0, 1);
    const sGeddesAlpha = clamp(sGeddes / T_IN, 0, 1) * clamp((1-sGeddes)/(1-T_OUT), 0, 1);
    const s4Alpha = clamp(s4 / T_IN, 0, 1) * clamp((1-s4)/(1-T_OUT), 0, 1);
    const s5Alpha = clamp(s5 / T_IN, 0, 1) * clamp((1-s5)/(1-T_OUT), 0, 1);
    const s9Alpha = clamp(s9 / T_IN, 0, 1) * clamp((1-s9)/(1-T_OUT), 0, 1);
    const s11Alpha = clamp(s11 / T_IN, 0, 1) * clamp((1-s11)/(1-T_OUT), 0, 1);
    const s13Alpha = clamp(s13 / T_IN, 0, 1) * clamp((1-s13)/(1-T_OUT), 0, 1);
    const s14Alpha = clamp(s14 / T_IN, 0, 1) * clamp((1-s14)/(1-T_OUT), 0, 1);
    
    /* Full-bleed sections (In: 15% -> 25%, Out: 90% -> 100%) */
    const s3AlphaIn = clamp((s3 - 0.15) / 0.10, 0, 1); 
    const s3AlphaOut = s3AlphaIn * clamp((1-s3)/(1-0.90), 0, 1); 
    
    const s8AlphaIn = clamp((s8 - 0.15) / 0.10, 0, 1); 
    const s8AlphaOut = s8AlphaIn * clamp((1-s8)/(1-0.90), 0, 1); 
    
    const s12AlphaIn = clamp((s12 - 0.15) / 0.10, 0, 1); 
    const s12AlphaOut = s12AlphaIn * clamp((1-s12)/(1-0.90), 0, 1); 
    
    const s15Group = clamp((s15 - 0.15) / 0.10, 0, 1); 
    const s15AlphaOut = s15Group * clamp((1-s15)/(1-0.90), 0, 1); 
    
    
    /* Map section (sMapA) timing (In: 5% -> 15%, Out: 90% -> 100%) */
    const sMapAAlphaIn = clamp((sMapA - 0.05) / 0.10, 0, 1); 
    const sMapAAlphaOut = sMapAAlphaIn * clamp((1-sMapA)/(1-0.90), 0, 1); 
    
    // ... (Gallery A, B, C logic) ...
    
    /* Set final image opacities for image-text sections */
    root.style.setProperty('--s1ImgOpacity', s1Alpha.toFixed(3));
    root.style.setProperty('--s2ImgOpacity', s2Alpha.toFixed(3));
    root.style.setProperty('--sGeddesImgOpacity', sGeddesAlpha.toFixed(3));
    root.style.setProperty('--s3ImgOpacity', s3AlphaOut.toFixed(3));
    root.style.setProperty('--s4ImgOpacity', s4Alpha.toFixed(3));
    root.style.setProperty('--sMapAImgOpacity', sMapAAlphaOut.toFixed(3));
    root.style.setProperty('--s5ImgOpacity', s5Alpha.toFixed(3));
    root.style.setProperty('--s8ImgOpacity', s8AlphaOut.toFixed(3));
    root.style.setProperty('--s9ImgOpacity', s9Alpha.toFixed(3));
    root.style.setProperty('--s11ImgOpacity', s11Alpha.toFixed(3));
    root.style.setProperty('--s12ImgOpacity', s12AlphaOut.toFixed(3));
    root.style.setProperty('--s13ImgOpacity', s13Alpha.toFixed(3));
    root.style.setProperty('--s14ImgOpacity', s14Alpha.toFixed(3));
    root.style.setProperty('--s15ImgOpacity', s15AlphaOut.toFixed(3));

requestAnimationFrame(update);
}

async function init(){
if(document.fonts && document.fonts.ready){ try{ await document.fonts.ready; }catch(e){} }
measureHero();
measureS1(); measureS2(); measureSGeddes(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15();
update();
addEventListener('load',  ()=>{ measureHero(); measureS1(); measureS2(); measureSGeddes(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15(); });
addEventListener('resize',()=>{ measureHero(); measureS1(); measureS2(); measureSGeddes(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15(); });
}

init();
})();
</script>


<script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script><script>
mapboxgl.accessToken = 'pk.eyJ1Ijoia2F2bmkiLCJhIjoiY2s5YjBqNGY1MGV4aTNobnk0amJncWZweCJ9.gZK_r9CYmb6ZN_mZVmgjNg';
const MAP_START_CENTER = [34.770081, 32.079031];
const MAP_START_ZOOM = 15.99;
const mapFrame = document.querySelector('.sMapA-frame');
const mapContainer = document.getElementById('mapA-container');
const mapSection = document.querySelector('#mapSection'); 
const exitBtn = document.getElementById("exit-map-button");

// Initialize Mapbox map
const map = new mapboxgl.Map({
    container: 'mapA-container',
    style: 'mapbox://styles/kavni/cmhkpt4uz00et01pjheur1zc1', 
    center: MAP_START_CENTER,
    zoom: MAP_START_ZOOM,
    interactive: false
});

map.on('load', () => {
    map.scrollZoom.disable();
    map.dragPan.disable();
    map.doubleClickZoom.disable();
    map.touchZoomRotate.disable();
});

// Enable/Disable map interactions based on scroll position
function toggleMapPointer() {
    const mapSectionDriver = document.getElementById('sMapA-wrap');
    if (!mapSectionDriver) return;

    const rect = mapSectionDriver.getBoundingClientRect();
    const visible = rect.top < window.innerHeight * 0.8 &&
                    rect.bottom > window.innerHeight * 0.2;

    if (visible) {
        mapFrame.classList.add('active');
        map.dragPan.enable();
        map.doubleClickZoom.enable();
        map.touchZoomRotate.enable();
    } else {
        mapFrame.classList.remove('active');
        map.scrollZoom.disable();
        map.dragPan.disable();
        map.doubleClickZoom.disable();
        map.touchZoomRotate.disable();
    }
}

// Mouse leave → give scroll back to page (Crucial for scrollytelling handover)
mapContainer.addEventListener('mouseleave', () => map.scrollZoom.disable());
mapContainer.addEventListener('mouseenter', () => {
    const mapSectionDriver = document.getElementById('sMapA-wrap');
    const rect = mapSectionDriver.getBoundingClientRect();
    const visible = rect.top < window.innerHeight * 0.8 &&
                    rect.bottom > window.innerHeight * 0.2;
    if (visible) map.scrollZoom.enable();
});

// EXIT MAP button
exitBtn.addEventListener("click", () => {
  mapContainer.style.pointerEvents = "none";
  window.scrollBy({ top: window.innerHeight * 0.6, behavior: "smooth" });
});

window.addEventListener('scroll', toggleMapPointer, { passive: true });
window.addEventListener('resize', toggleMapPointer);
toggleMapPointer();
</script>

</body>
</html>
